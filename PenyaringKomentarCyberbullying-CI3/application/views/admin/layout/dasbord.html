<div id="content-wrapper">

    <div class="container-fluid">

      <!-- Breadcrumbs-->
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="<?php echo base_url('Admin');?>">Dashboard</a>
        </li>
        <li class="breadcrumb-item active">Tinjauan</li>
      </ol>

      <!-- Icon Cards-->
      <div class="row">
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-primary o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fa fa-sticky-note"></i>
              </div>
              <div class="mr-5 total-artikel"></div>
            </div>
            <a class="card-footer text-white clearfix small z-1" href="<?php echo base_url('Admin/artikel_kelola');?>">
              <span class="float-left">Lihat Detail</span>
              <span class="float-right">
                <i class="fas fa-angle-right"></i>
              </span>
            </a>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-info o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fa fa-eye"></i>
              </div>
              <div class="mr-5 total-tayangan"></div>
            </div>
            <a class="card-footer text-white clearfix small z-1" href="<?php echo base_url('Admin/artikel_kelola');?>">
              <span class="float-left">Lihat Detail</span>
              <span class="float-right">
                <i class="fas fa-angle-right"></i>
              </span>
            </a>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-warning o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fa fa-star"></i>
              </div>
              <div class="mr-5 total-rating"></div>
            </div>
            <a class="card-footer text-white clearfix small z-1" href="<?php echo base_url('Admin/artikel_kelola');?>">
              <span class="float-left">Lihat Detail</span>
              <span class="float-right">
                <i class="fas fa-angle-right"></i>
              </span>
            </a>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-danger o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fas fa-fw fa-comments"></i>
              </div>
              <div class="mr-5 total-komentar"></div>
            </div>
            <a class="card-footer text-white clearfix small z-1" href="<?php echo base_url('Admin/artikel_kelola');?>">
              <span class="float-left">Lihat Detail</span>
              <span class="float-right">
                <i class="fas fa-angle-right"></i>
              </span>
            </a>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-black bg-light o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fa fa-id-card"></i>
              </div>
              <div class="mr-5 total-pengikut"></div>
            </div>
            <a class="card-footer text-black clearfix small z-1" href="<?php echo base_url('Admin/follower');?>">
              <span class="float-left">Lihat Detail</span>
              <span class="float-right">
                <i class="fas fa-angle-right"></i>
              </span>
            </a>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-black bg-light o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fa fa-id-card"></i>
              </div>
              <div class="mr-5 total-mengikuti"></div>
            </div>
            <a class="card-footer text-black clearfix small z-1" href="<?php echo base_url('Admin/following');?>">
              <span class="float-left">Lihat Detail</span>
              <span class="float-right">
                <i class="fas fa-angle-right"></i>
              </span>
            </a>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-danger bg-white o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fa fa-bell"></i>
              </div>
              <div class="mr-5 total-notifikasi"><?php if($notifikasi>0){echo  "$notifikasi Pemberitahuan";}?></div>
            </div>
            <a class="card-footer text-danger clearfix small z-1" href="<?php echo base_url('admin/notifikasi');?>">
              <span class="float-left">Lihat Detail</span>
              <span class="float-right">
                <i class="fas fa-angle-right"></i>
              </span>
            </a>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-3">
          <div class="card text-white bg-success o-hidden h-100">
            <div class="card-body">
              <div class="card-body-icon">
                <i class="fa fa-user"></i>
              </div>
              <div class="mr-5 aktivasi-akun"><?php if ($this->ion_auth->is_admin()){echo 'Admin';}else{echo 'Member';} $user = $this->ion_auth->user()->row();if($user->active==1){echo " &radic;";}else{echo " &chi;<br/>Belum teraktivasi";}?></div>
            </div>
            <a class="card-footer text-white clearfix small z-1" href="<?php echo base_url('Admin/profil');?>">
              <span class="float-left">Lihat Detail</span>
              <span class="float-right">
                <i class="fas fa-angle-right"></i>
              </span>
            </a>
          </div>
        </div>
      </div>

      <!-- Area Chart tayangan-->
      <div class="card mb-3">
        <div class="card-header">
          <i class="fas fa-chart-area"></i>
          <b>Perkembangan Tayangan Seluruh Artikel</b>
        </div>
        <div class="card-body">
          <div class="row">
              <div class="form-group col-lg-3">
                  <label for="judulartikel">Dari Tanggal:</label>
                  <input type="date" class="form-control" id="tanggalawaltotaltayangan" name="tanggalawaltotaltayangan" placeholder="Tanggal awal...">
              </div>
              <div class="form-group col-lg-3">
                  <label for="judulartikel">Sampai Tanggal:</label>
                  <input type="date" class="form-control" id="tanggalakhirtotaltayangan" name="tanggalakhirtotaltayangan" placeholder="Tanggal akhir...">
              </div>
              <div class="form-group col-lg-2">
                  <br/>                            
                  <button type="button" class="btn btn-primary" id="prosestotaltayangan" value="prosestotaltayangan">Proses</button>
              </div>
          </div>
          <div class="row">
              <div class="form-group col-lg-6">
                  <input type="text" disabled class="form-control" id="totaltayangan" name="totaltayangan" placeholder="total tayangan...">
              </div>
          </div>
          <div id="statistik-by-pengunjungseluruhnya">
              
              <canvas id="statistik-pengunjung-seluruhnya" width="100%" height="30"></canvas>
          </div>
        </div>
        <div class="card-footer small text-muted">Copyright &copy;<script>document.write(new Date().getFullYear());</script> KebaikanKita.com</div>
      </div>

      <!-- Area Chart Top Artikel-->
      <div class="card mb-3">
        <div class="card-header">
          <i class="fas fa-chart-area"></i>
          <b>Perbandingan Artikel Terpopuler</b>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="form-group col-lg-3">
                    <label for="judulartikel">Dari Tanggal:</label>
                    <input type="date" class="form-control" id="tanggalawalartikelpopuler" name="tanggalawalartikelpopuler" placeholder="Tanggal awal...">
                </div>
                <div class="form-group col-lg-3">
                    <label for="judulartikel">Sampai Tanggal:</label>
                    <input type="date" class="form-control" id="tanggalakhirartikelpopuler" name="tanggalakhirartikelpopuler" placeholder="Tanggal awal...">
                </div>
                <div class="form-group col-lg-2">
                    <br/>                            
                    <button type="button" class="btn btn-primary" id="prosesartikelpopuler" value="prosesartikelpopuler">Proses</button>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-lg-6">
                    <input type="text" disabled class="form-control" id="totaltayanganpopuler" name="totaltayanganpopuler" placeholder="total tayangan...">
                </div>
            </div>
          <div id="statistik-by-topten">
              <canvas id="statistik-top-ten" width="100%" height="30"></canvas>
          </div>
        </div>
        <div class="card-footer small text-muted">Copyright &copy;<script>document.write(new Date().getFullYear());</script> KebaikanKita.com</div>
      </div>

      <!-- Area Chart Artikel-->
      <div class="card mb-3">
        <div class="card-header">
          <i class="fas fa-chart-area"></i>
          <b>Grafik Perkembangan Tayangan Artikel</b>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="form-group col-lg-3">
                    <label for="judulartikel">Dari Tanggal:</label>
                    <input type="date" class="form-control" id="tanggalawalgrafikartikel" name="tanggalawalgrafikartikel" placeholder="Tanggal awal...">
                </div>
                <div class="form-group col-lg-3">
                    <label for="judulartikel">Sampai Tanggal:</label>
                    <input type="date" class="form-control" id="tanggalakhirgrafikartikel" name="tanggalakhirgrafikartikel" placeholder="Tanggal akhir...">
                </div>
            </div>
            <div class="row">
                <div class="form-group col-lg-6">
                    <input type="text" disabled class="form-control" id="totaltayangangrafikartikel" name="totaltayangangrafikartikel" placeholder="total tayangan...">
                </div>
            </div>
            <div class="form-group">
                <select multiple class="form-control" id="exampleFormControlSelect2">
                  <?php foreach($daftar_artikel->result() as $artikel){?>
                    <option data-idx="<?php echo $artikel->ID_POSTING;?>" class="report-post">
                      <?php echo $artikel->JUDUL;?>
                    </option>
                  <?php }?>
                </select>
            </div>
            <div id="statistik-by-pengunjung">
              <canvas id="statistik-pengunjung" width="100%" height="30"></canvas>
            </div>
        </div>
        <div class="card-footer small text-muted">Copyright &copy;<script>document.write(new Date().getFullYear());</script> KebaikanKita.com</div>
      </div>

      <!-- Area Chart Top Rating-->
      <div class="card mb-3">
        <div class="card-header">
          <i class="fas fa-chart-area"></i>
          <b>Perbandingan Artikel Top Rating</b>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="form-group col-lg-3">
                    <label for="judulartikel">Dari Tanggal:</label>
                    <input type="date" class="form-control" id="tanggalawalratingpopuler" name="tanggalawalratingpopuler" placeholder="Tanggal awal...">
                </div>
                <div class="form-group col-lg-3">
                    <label for="judulartikel">Sampai Tanggal:</label>
                    <input type="date" class="form-control" id="tanggalakhirratingpopuler" name="tanggalakhirratingpopuler" placeholder="Tanggal akhir...">
                </div>
                <div class="form-group col-lg-2">
                  <br/>                            
                  <button type="button" class="btn btn-primary" id="prosesratingpopuler" value="prosesratingpopuler">Proses</button>
              </div>
            </div>
            <div class="row">
                <div class="form-group col-lg-6">
                    <input type="text" disabled class="form-control" id="rataratingpopuler" name="rataratingpopuler" placeholder="Rata-rata rating artikel...">
                </div>
            </div>
          <div id="statistik-by-rating">
            <canvas id="statistik-top-rating" width="100%" height="30"></canvas>
          </div>
        </div>
        <div class="card-footer small text-muted">Copyright &copy;<script>document.write(new Date().getFullYear());</script> KebaikanKita.com</div>
      </div>

      <!-- Area Chart Rating-->
      <div class="card mb-3">
        <div class="card-header">
          <i class="fas fa-chart-area"></i>
          <b>Grafik Perkembangan Rating Artikel</b>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="form-group col-lg-3">
                    <label for="judulartikel">Dari Tanggal:</label>
                    <input type="date" class="form-control" id="tanggalawalgrafikrating" name="tanggalawalgrafikrating" placeholder="Tanggal awal...">
                </div>
                <div class="form-group col-lg-3">
                    <label for="judulartikel">Sampai Tanggal:</label>
                    <input type="date" class="form-control" id="tanggalakhirgrafikrating" name="tanggalakhirgrafikrating" placeholder="Tanggal akhir...">
                </div>
            </div>
            <div class="row">
                <div class="form-group col-lg-6">
                    <input type="text" disabled class="form-control" id="ratarating" name="ratarating" placeholder="Rata-rata rating artikel...">
                </div>
            </div>
            <div class="form-group">
                <select multiple class="form-control" id="exampleFormControlSelect2">
                  <?php foreach($daftar_artikel->result() as $artikel){?>
                    <option data-idy="<?php echo $artikel->ID_POSTING;?>" class="report-rating">
                      <?php echo $artikel->JUDUL;?>
                    </option>
                  <?php }?>
                </select>
            </div>
            <div id="rating-by-artikel">
              <canvas id="statistik-rating" width="100%" height="30"></canvas>
            </div>
        </div>
        <div class="card-footer small text-muted">Copyright &copy;<script>document.write(new Date().getFullYear());</script> KebaikanKita.com</div>
      </div>

    </div>
    <!-- /.container-fluid -->

    <script src="<?php echo base_url('asset/jquery/jquery.min.js');?>"></script>

    <script>
      $(document).ready(function(){
        let BASE_URL = "<?php echo base_url();?>";
        $('.report-post').on('click', function(){
          let idx = $(this).data('idx');
          let tglawal = $('#tanggalawalgrafikartikel').val();
          let tglakhir = $('#tanggalakhirgrafikartikel').val();
          $.ajax({
            url: BASE_URL + 'Artikel/laporan_artikel',
            data: {idx : idx, tglawal : tglawal, tglakhir : tglakhir},
            method: 'post',
            dataType: 'json',
            success: function(response){
              $('#statistik-pengunjung').remove(); 
              $('#statistik-by-pengunjung').append('<canvas id="statistik-pengunjung" width="100%" height="30"></canvas>');
              let $c = $('#statistik-pengunjung');
              let ctx = $c.get(0).getContext('2d');
              laporan_pengunjung(ctx, response.tanggal, response.view, response.judul);
              $('#totaltayangangrafikartikel').val(response.total + " total tayangan");
            },
            error: function (xhr, ajaxOptions, thrownError) { 
              alert(xhr.responseText) 
            }
          });
        });

        $('#cetak-statistik-pengunjung').on('click', function(){
          var canvas = document.getElementById("statistik-pengunjung");
          var win = window.open();
          win.document.write("<br><img src='" + canvas.toDataURL() + "'/>");
          win.print();
          win.location.reload();
        });

        function laporan_pengunjung(ctx,tanggalx,viewx,judulx){
          judul = "";
          tanggal = [];
          view = [];

          judul = judulx;
          tanggal = tanggalx;
          view = viewx;
          
          var myChart = new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: tanggal,
                  datasets: [{
                      label: 'Perkembangan Tayangan Artikel"' + judul +'"',
                      data: view,
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.2)',
                          'rgba(54, 162, 235, 0.2)',
                          'rgba(255, 206, 86, 0.2)',
                          'rgba(75, 192, 192, 0.2)',
                          'rgba(153, 102, 255, 0.2)',
                          'rgba(255, 159, 64, 0.2)'
                      ],
                      borderColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero: true
                          }
                      }]
                  }
              }
          });   
        }

        $('.report-rating').on('click', function(){
          let idx = $(this).data('idy');
          let tglawal = $('#tanggalawalgrafikrating').val();
          let tglakhir = $('#tanggalakhirgrafikrating').val();
          $.ajax({
            url: BASE_URL + 'Artikel/laporan_rating',
            data: {idx : idx, tglawal : tglawal, tglakhir : tglakhir},
            method: 'post',
            dataType: 'json',
            success: function(response){
              $('#statistik-rating').remove(); 
              $('#rating-by-artikel').append('<canvas id="statistik-rating" width="100%" height="30"></canvas>');
              let $c = $('#statistik-rating');
              let ctx = $c.get(0).getContext('2d');
              laporan_pengunjung(ctx, response.tanggal, response.rating, response.judul);
              $('#ratarating').val(response.rata + " rata-rata rating artikel");
            },
            error: function (xhr, ajaxOptions, thrownError) { 
              alert(xhr.responseText) 
            }
          });
        });

        $('#cetak-statistik-rating').on('click', function(){
          var canvas = document.getElementById("statistik-rating");
          var win = window.open();
          win.document.write("<br><img src='" + canvas.toDataURL() + "'/>");
          win.print();
          win.location.reload();
        });

        function laporan_rating(ctx,tanggalx,ratingx,judulx){
          judul = "";
          tanggal = [];
          view = [];

          judul = judulx;
          tanggal = tanggalx;
          view = ratingx;
          
          var myChart = new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: tanggal,
                  datasets: [{
                      label: 'Perkembangan Tayangan Artikel"' + judul +'"',
                      data: view,
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.2)',
                          'rgba(54, 162, 235, 0.2)',
                          'rgba(255, 206, 86, 0.2)',
                          'rgba(75, 192, 192, 0.2)',
                          'rgba(153, 102, 255, 0.2)',
                          'rgba(255, 159, 64, 0.2)'
                      ],
                      borderColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero: true
                          }
                      }]
                  }
              }
          });   
        }


        $('#prosestotaltayangan').on('click', function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          let tglawal = $('#tanggalawaltotaltayangan').val();
          let tglakhir = $('#tanggalakhirtotaltayangan').val();
          $.ajax({
            url: BASE_URL + 'Artikel/laporan_tayangan',
            data: {idx : idx, tglawal : tglawal, tglakhir : tglakhir},
            method: 'post',
            dataType: 'json',
            success: function(response){
              $('#statistik-pengunjung-seluruhnya').remove(); 
              $('#statistik-by-pengunjungseluruhnya').append('<canvas id="statistik-pengunjung-seluruhnya" width="100%" height="30"></canvas>');
              var $d = $('#statistik-pengunjung-seluruhnya');
              var cty = $d.get(0).getContext('2d');
              laporan_pengunjung_seluruhnya(cty, response.tanggal, response.view, response.judul);
              $('#totaltayangan').val(response.total + " total tayangan");
            },
            error: function (xhr, ajaxOptions, thrownError) { 
              alert(xhr.responseText) 
            }
          });
        });

        $('#statistik-pengunjung-seluruhnya').ready(function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          let tglawal = "";
          let tglakhir = "";
          $.ajax({
            url: BASE_URL + 'Artikel/laporan_tayangan',
            data: {idx : idx, tglawal : tglawal, tglakhir : tglakhir},
            method: 'post',
            dataType: 'json',
            success: function(response){
              $('#statistik-pengunjung-seluruhnya').remove(); 
              $('#statistik-by-pengunjungseluruhnya').append('<canvas id="statistik-pengunjung-seluruhnya" width="100%" height="30"></canvas>');
              var $d = $('#statistik-pengunjung-seluruhnya');
              var cty = $d.get(0).getContext('2d');
              laporan_pengunjung_seluruhnya(cty, response.tanggal, response.view, response.judul);
              $('#totaltayangan').val(response.total + " total tayangan");
            },
            error: function (xhr, ajaxOptions, thrownError) { 
              alert(xhr.responseText) 
            }
          });
        });

        $('#cetak-statistik-pengunjung-seluruhnya').on('click', function(){
          var canvas = document.getElementById("statistik-pengunjung-seluruhnya");
          var win = window.open();
          win.document.write("<br><img src='" + canvas.toDataURL() + "'/>");
          win.print();
          win.location.reload();
        });
        

        function laporan_pengunjung_seluruhnya(cty, tanggal, view, judul){
          var myChart2 = new Chart(cty, {
              type: 'line',
              data: {
                  labels: tanggal,
                  datasets: [{
                      label: judul,
                      data: view,
                      backgroundColor: [
                      'rgba(0, 0, 0, 0.1)',
                      'rgba(0, 0, 0, 0.1)',
                      'rgba(0, 0, 0, 0.1)',
                      'rgba(0, 0, 0, 0.1)',
                      'rgba(0, 0, 0, 0.1)',
                      'rgba(0, 0, 0, 0.1)'
                      ],
                      borderColor: [
                      'rgba(0, 0, 0, 0.1)',
                      'rgba(0, 0, 0, 0.1)',
                      'rgba(0, 0, 0, 0.1)',
                      'rgba(0, 0, 0, 0.1)',
                      'rgba(0, 0, 0, 0.1)',
                      'rgba(0, 0, 0, 0.1)' 
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero: true
                          }
                      }]
                  }
              }
          });   
        }


        $('#statistik-top-ten').ready(function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          let tglawal = "";
          let tglakhir = "";
          $.ajax({
            url: BASE_URL + 'Artikel/laporan_top_artikel',
            data: {idx : idx, tglawal : tglawal, tglakhir : tglakhir},
            method: 'post',
            dataType: 'json',
            success: function(response){
              $('#statistik-top-ten').remove(); 
              $('#statistik-by-topten').append('<canvas id="statistik-top-ten" width="100%" height="30"></canvas>');
              let $d = $('#statistik-top-ten');
              let cty = $d.get(0).getContext('2d');
              laporan_top_ten(cty, response.artikel, response.view, response.judul);
              $('#totaltayanganpopuler').val(response.total + " total tayangan");
            },
            error: function (xhr, ajaxOptions, thrownError) {
              alert(xhr.responseText) 
            }
          });
        });

        $('#cetak-statistik-top-ten').on('click', function(){
          var canvas = document.getElementById("statistik-top-ten");
          var win = window.open();
          win.document.write("<br><img src='" + canvas.toDataURL() + "'/>");
          win.print();
          win.location.reload();
        });

        $('#prosesartikelpopuler').on('click', function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          let tglawal = $('#tanggalawalartikelpopuler').val();
          let tglakhir = $('#tanggalakhirartikelpopuler').val();
          $.ajax({
            url: BASE_URL + 'Artikel/laporan_top_artikel',
            data: {idx : idx, tglawal : tglawal, tglakhir : tglakhir},
            method: 'post',
            dataType: 'json',
            success: function(response){
              $('#statistik-top-ten').remove(); 
              $('#statistik-by-topten').append('<canvas id="statistik-top-ten" width="100%" height="30"></canvas>');
              let $d = $('#statistik-top-ten');
              let cty = $d.get(0).getContext('2d');
              laporan_top_ten(cty, response.artikel, response.view, response.judul);
              $('#totaltayanganpopuler').val(response.total + " total tayangan");
            },
            error: function (xhr, ajaxOptions, thrownError) {
              alert(xhr.responseText) 
            }
          });
        });

        function laporan_top_ten(cty, artikel, view, judul){
          var myChart2 = new Chart(cty, {
              type: 'doughnut',
              data: {
                  labels: artikel,
                  datasets: [{
                      label: judul,
                      data: view,
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.2)',
                          'rgba(54, 162, 235, 0.2)',
                          'rgba(255, 206, 86, 0.2)',
                          'rgba(75, 192, 192, 0.2)',
                          'rgba(153, 102, 255, 0.2)',
                          'rgba(255, 159, 64, 0.2)'
                      ],
                      borderColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero: true
                          }
                      }]
                  }
              }
          });   
        }


        $('#statistik-top-rating').ready(function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          let tglawal = "";
          let tglakhir = "";
          $.ajax({
            url: BASE_URL + 'Artikel/laporan_top_rating',
            data: {idx : idx, tglawal : tglawal, tglakhir : tglakhir},
            method: 'post',
            dataType: 'json',
            success: function(response){
              $('#statistik-top-rating').remove(); 
              $('#statistik-by-rating').append('<canvas id="statistik-top-rating" width="100%" height="30"></canvas>');
              let $d = $('#statistik-top-rating');
              let ctz = $d.get(0).getContext('2d');
              laporan_top_rating(ctz, response.artikel, response.rating, response.judul);
              $('#rataratingpopuler').val(response.rata + " rata-rata rating artikel");
            },
            error: function (xhr, ajaxOptions, thrownError) { 
              alert(xhr.responseText) 
            }
          });
        });

        $('#cetak-statistik-top-rating').on('click', function(){
          var canvas = document.getElementById("statistik-top-rating");
          var win = window.open();
          win.document.write("<br><img src='" + canvas.toDataURL() + "'/>");
          win.print();
          win.location.reload();
        });

        $('#prosesratingpopuler').on('click',function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          let tglawal = $('#tanggalawalratingpopuler').val();
          let tglakhir = $('#tanggalakhirratingpopuler').val();
          $.ajax({
            url: BASE_URL + 'Artikel/laporan_top_rating',
            data: {idx : idx, tglawal : tglawal, tglakhir : tglakhir},
            method: 'post',
            dataType: 'json',
            success: function(response){
              $('#statistik-top-rating').remove(); 
              $('#statistik-by-rating').append('<canvas id="statistik-top-rating" width="100%" height="30"></canvas>');
              let $d = $('#statistik-top-rating');
              let ctz = $d.get(0).getContext('2d');
              laporan_top_rating(ctz, response.artikel, response.rating, response.judul);
              $('#rataratingpopuler').val(response.rata + " rata-rata rating artikel");
            },
            error: function (xhr, ajaxOptions, thrownError) { 
              alert(xhr.responseText) 
            }
          });
        });

        function laporan_top_rating(ctz, artikel, rating, judul){
          var myChart2 = new Chart(ctz, {
              type: 'bar',
              data: {
                  labels: artikel,
                  datasets: [{
                      label: judul,
                      data: rating,
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.2)',
                          'rgba(54, 162, 235, 0.2)',
                          'rgba(255, 206, 86, 0.2)',
                          'rgba(75, 192, 192, 0.2)',
                          'rgba(153, 102, 255, 0.2)',
                          'rgba(255, 159, 64, 0.2)'
                      ],
                      borderColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero: true
                          }
                      }]
                  }
              }
          });   
        }

        $('.total-artikel').ready(function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          $.ajax({
            url: BASE_URL + 'Artikel/total_artikel',
            data: {idx : idx},
            method: 'post',
            dataType: 'json',
            success: function(response){
              if(response.sukses=="sukses"){
                $('.total-artikel').html(response.total +" Artikel");
              }
            },
            error: function (xhr, ajaxOptions, thrownError) { 
              alert(xhr.responseText) 
            }
          });
        });

        $('.total-tayangan').ready(function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          $.ajax({
            url: BASE_URL + 'Artikel/total_tayangan',
            data: {idx : idx},
            method: 'post',
            dataType: 'json',
            success: function(response){
              if(response.sukses=="sukses"){
                $('.total-tayangan').html(response.total +" Tayangan");
              }
            },
            error: function (xhr, ajaxOptions, thrownError) { 
              alert(xhr.responseText) 
            }
          });
        });

        $('.total-rating').ready(function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          $.ajax({
            url: BASE_URL + 'Artikel/total_rating',
            data: {idx : idx},
            method: 'post',
            dataType: 'json',
            success: function(response){
              if(response.sukses=="sukses"){
                $('.total-rating').html(response.total +" Rating");
              }
            },
            error: function (xhr, ajaxOptions, thrownError) { 
              alert(xhr.responseText) 
            }
          });
        });

        $('.total-komentar').ready(function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          $.ajax({
            url: BASE_URL + 'Artikel/total_komentar',
            data: {idx : idx},
            method: 'post',
            dataType: 'json',
            success: function(response){
              if(response.sukses=="sukses"){
                $('.total-komentar').html(response.total +" Komentar");
              }
            },
            error: function (xhr, ajaxOptions, thrownError) {
              alert(xhr.responseText) 
            }
          });
        });

        $('.total-pengikut').ready(function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          $.ajax({
            url: BASE_URL + 'Artikel/total_pengikut',
            data: {idx : idx},
            method: 'post',
            dataType: 'json',
            success: function(response){
              if(response.sukses=="sukses"){
                $('.total-pengikut').html(response.total +" Pengikut");
              }else{
                $('.total-pengikut').html(0 +" Pengikut");
              }
            },
            error: function (xhr, ajaxOptions, thrownError) { 
              alert(xhr.responseText) 
            }
          });
        });

        $('.total-mengikuti').ready(function(){
          const idx = "<?php echo $_SESSION['user_id'];?>";
          $.ajax({
            url: BASE_URL + 'Artikel/total_mengikuti',
            data: {idx : idx},
            method: 'post',
            dataType: 'json',
            success: function(response){
              if(response.sukses=="sukses"){
                $('.total-mengikuti').html(response.total +" Mengikuti");
              }else{
                $('.total-mengikuti').html("0 Mengikuti");
              }
            },
            error: function (xhr, ajaxOptions, thrownError) { 
              alert(xhr.responseText) 
            }
          });
        });

    })
  </script>